<!doctype html>
<html>

<head>
  <script src="pixi.min.js"></script>
  <link rel="stylesheet" href="css.css">
  
</head>

<body>
  <button id="fullscreen-btn">Fullscreen</button>
  <script type="module">
    function keyDown(e) {
      console.log(e.keyCode);
      keys[e.keyCode] = true;
    }

    function keyUp(e) {
      console.log(e.keyCode);
      keys[e.keyCode] = false;
    }

    function spawnWall() {
      console.log("spawn");
      let wallSprite = PIXI.Sprite.from('Images/square.png');
      wallSprite.width = 50;
      wallSprite.height = 50;
      wallSprite.x = gameWidth;
      wallSprite.y = Math.floor(Math.random() * (gameHeight - wallSprite.height));
      app.stage.addChild(wallSprite);
      wallSprites.push(wallSprite);
      isWallSpawning = false;


    }

    function movementControll(isTouchedByWallByRight, isTouchedByWallByLeft, isTouchedByWallByTop, isTouchedByWallByBottom) {
      if (sprite.y >= 0) {
        if (!isTouchedByWallByTop) {
          if (keys["38"]) {
            sprite.y -= speedOfPlayer;
          }
        }
      }
      if (sprite.y < gameHeight - sprite.height) {
        if (!isTouchedByWallByBottom) {
          if (keys["40"]) {
            sprite.y += speedOfPlayer;
          }
        }
      }
      if (!isTouchedByWallByLeft) {
        if (keys["37"]) {
          sprite.x -= speedOfPlayer;
        }
      }
      if (!isTouchedByWallByRight) {
        if (keys["39"]) {
          sprite.x += speedOfPlayer;
        }
      }

    }
    const app = new PIXI.Application({
      autoResize: true,
      resolution: devicePixelRatio
    });

    let keys = {};
    let keysDiv;
    let wallSprites = [];
    let timeStart = new Date;
    let startedSpawning = false;
    let isWallSpawning = false;
    let timeUntilWallSpawn = 200;

    const gameWidth = 1000;
    const gameHeight = 500;
    let speedOfWalls = 5;
    const speedOfPlayer = 3;
    const playerWidth = 15;
    const playerHeight = 15;
    let comptorHowManyWallsDied = 0;
    let playerScore = 0;

    await app.init({ background: 'black', width: gameWidth, height: gameHeight, padding: 200 });


    document.body.appendChild(app.canvas);


    // Create the sprite and add it to the stage
    await PIXI.Assets.load('Images/square.png');
    let sprite = PIXI.Sprite.from('Images/square.png');
    sprite.width = playerWidth;
    sprite.height = playerHeight;
    app.stage.addChild(sprite);

    window.addEventListener("keydown", keyDown);
    window.addEventListener("keyup", keyUp);
    keysDiv = document.querySelector("#keys");
    // Add a ticker callback to move the sprite back and forth
    let elapsed = 0.0;
    app.ticker.add((ticker) => {
      let nowTime = new Date;
      let isTouchedByWallByTop = false;
      let isTouchedByWallByLeft = false;
      let isTouchedByWallByBottom = false;
      let isTouchedByWallByRight = false;

      //keysDiv.innerHTML = JSON.stringify(keys);
      elapsed += ticker.deltaTime;

      if (!isWallSpawning) {
        setTimeout(spawnWall, timeUntilWallSpawn);
        //timeUntilWallSpawn -= 25;
        isWallSpawning = true;
      }

      if (comptorHowManyWallsDied >= 100) {
        timeUntilWallSpawn -= 15;
        speedOfWalls += 1;
        comptorHowManyWallsDied = 0;
      }



      wallSprites.forEach(wall => {



        if (sprite.y + sprite.height > wall.y - speedOfPlayer && sprite.y <= wall.y && sprite.x >= wall.x && sprite.x <= wall.x + wall.width) {
          isTouchedByWallByBottom = true;
        }

        if (sprite.y < wall.y + wall.height + speedOfPlayer && sprite.y >= wall.y + wall.height && sprite.x >= wall.x && sprite.x <= wall.x + wall.width) {
          isTouchedByWallByTop = true;
        }


        if (sprite.x + sprite.width > wall.x - speedOfPlayer && sprite.x <= wall.x && sprite.y >= wall.y && sprite.y <= wall.y + wall.height) {
          isTouchedByWallByRight = true;
          sprite.x -= speedOfWalls;
        }

        if (sprite.x < wall.x + wall.width + speedOfPlayer && sprite.x >= wall.x + wall.width && sprite.y >= wall.y && sprite.y <= wall.y + wall.height) {
          isTouchedByWallByLeft = true;
        }


        console.log(isTouchedByWallByTop);


        wall.x -= speedOfWalls;

        if (wall.x + wall.width < 0) {
          app.stage.removeChild(wall);
          wallSprites.shift(wall);
          //console.log(wallSprites.length);
          comptorHowManyWallsDied += 1;
        }

      });

      movementControll(isTouchedByWallByRight, isTouchedByWallByLeft, isTouchedByWallByTop, isTouchedByWallByBottom);
      //console.log(isTouchedByWallByRight);

      //sprite.x = 100.0 + Math.cos(elapsed/50.0) * 100.0;

    });

    function toggleFullScreen() {
      const elem = document.documentElement;
      if (!document.fullscreenElement) {
        if (elem.requestFullscreen) {
          elem.requestFullscreen();
        } else if (elem.mozRequestFullScreen) { // Firefox
          elem.mozRequestFullScreen();
        } else if (elem.webkitRequestFullscreen) { // Chrome, Safari and Opera
          elem.webkitRequestFullscreen();
        } else if (elem.msRequestFullscreen) { // IE/Edge
          elem.msRequestFullscreen();
        }
      } else {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        } else if (document.mozCancelFullScreen) { // Firefox
          document.mozCancelFullScreen();
        } else if (document.webkitExitFullscreen) { // Chrome, Safari and Opera
          document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) { // IE/Edge
          document.msExitFullscreen();
        }
      }
    }

    const rect = new PIXI.Graphics()
      .beginFill(0xff0000)
      .drawRect(-100, -100, 100, 100);

    // Add it to the stage
    app.stage.addChild(rect);

    // Listen for window resize events
    window.addEventListener('resize', resize);

    function resize() {
      // Resize the renderer
      app.renderer.resize(window.innerWidth, window.innerHeight);

      // You can use the 'screen' property as the renderer visible
      // area, this is more useful than view.width/height because
      // it handles resolution
      rect.position.set(app.screen.width, app.screen.height);
    }

    document.getElementById('fullscreen-btn').addEventListener('click', toggleFullScreen, resize);
  </script>
</body>

</html>