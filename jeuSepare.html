<!doctype html>
<html>

<head>
  <script src="pixi.min.js"></script>
  <script src="./constants.js" type="module/javascript"></script>
  <script src="./gameObjectsConst.js" type="module/javascript"></script>
  <script src="./entities.js" type="module/javascript"></script>
  <script src="./startGame.js" type="module/javascript"></script>
  <script src="./Death.js" type="module/javascript"></script>
  <script src="https://www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"
    type="text/javascript"></script>
</head>

<body>

  <script type="module">

    import { app, gameWidth, gameHeight } from "./constants.js";
    import { wallsManagement, timerBeforeSpawningWall, increaseDifficultyOfWalls } from "./wallsManagement.js";
    import { movementControl } from "./controls.js";
    import { verifyIfGameStart } from "./startGame.js";
    import { hideOrShowObjectsWhenGameStart, showUnlockedLevels } from "./gameObjectsConst.js";
    import { castControlManagement } from "./receiver/controllReceiver.js";
    import { MortJoueur, lifeplayer } from "./Death.js";

    let playerScore = 0;
    let isGameStarted = false;
    let level = 0;
    let isLevel2Unlocked = false;
    let isLevel3Unlocked = false;
    let isLevel4Unlocked = false;
    let isLevel5Unlocked = false;
    const scoreToUnlockLevel2 = 5000;
    const scoreToUnlockLevel3 = 10000;
    const scoreToUnlockLevel4 = 20000;
    const scoreToUnlockLevel5 = 25000;

    await app.init({ background: 'black', width: gameWidth, height: gameHeight });
    document.body.appendChild(app.canvas);
    // Add a ticker callback to move the sprite back and forth
    let elapsed = 0.0;
    app.ticker.add((ticker) => {

      let isTouchedByWallByTop = false;
      let isTouchedByWallByLeft = false;
      let isTouchedByWallByBottom = false;
      let isTouchedByWallByRight = false;
      let isTouchedResponse = []
      let gameStartedAndLevelResponse = []
      isTouchedResponse = wallsManagement(isGameStarted, isTouchedByWallByTop, isTouchedByWallByLeft, isTouchedByWallByBottom, isTouchedByWallByRight, playerScore, level);
      playerScore = isTouchedResponse[4];


      if (!isGameStarted) {
        [isGameStarted, level] = verifyIfGameStart(isGameStarted, level, isLevel2Unlocked, isLevel3Unlocked, isLevel4Unlocked, isLevel5Unlocked);
      }



      //console.log(gameStartedAndLevelResponse);
      timerBeforeSpawningWall(isGameStarted, level);
      console.log(level);
      if (isGameStarted) {
        let playerIsAlive = true; 
        if (lifeplayer > 0) {
          playerIsAlive = false; 
        } else {
          playerIsAlive = true;
        }
        hideOrShowObjectsWhenGameStart(isGameStarted, playerScore, playerIsAlive);
        elapsed += ticker.deltaTime;
        increaseDifficultyOfWalls();
      }
      MortJoueur();
      showUnlockedLevels(isGameStarted, isLevel2Unlocked, isLevel3Unlocked, isLevel4Unlocked, isLevel5Unlocked);
      movementControl(isTouchedResponse[0], isTouchedResponse[1], isTouchedResponse[2], isTouchedResponse[3], level);
      //castControlManagement(isTouchedResponse[0], isTouchedResponse[1], isTouchedResponse[2], isTouchedResponse[3]);

    });
  </script>
  <script src="./wallsManagement.js" type="module/javascript"></script>
  <script src="./controls.js" type="module/javascript"></script>
  <script src="./receiver/controllReceiver.js" type="module/javascript"></script>
  <script src="./wallsManagement.js" type="module/javascript"></script>

</body>

</html>